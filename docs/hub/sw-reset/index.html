<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SW Reset</title>
</head>
<body>
  <h1>SW/Cache Reset</h1>
  <p>Service Worker と Cache Storage を削除して Hub に戻します。</p>
  <pre id="log">resetting...</pre>
  <script>
  (async () => {
    const log = (m)=>{ try{ document.getElementById('log').textContent += "\n" + m; }catch(e){} };
    try{
      if('serviceWorker' in navigator){
        const regs = await navigator.serviceWorker.getRegistrations();
        log("sw regs=" + regs.length);
        for(const r of regs){ try{ await r.unregister(); }catch(e){} }
        log("sw unregistered");
      }else{
        log("sw not supported");
      }
      if(window.caches){
        const keys = await caches.keys();
        log("cache keys=" + keys.length);
        for(const k of keys){ try{ await caches.delete(k); }catch(e){} }
        log("cache deleted");
      }else{
        log("caches not supported");
      }
      try{ localStorage.clear(); sessionStorage.clear(); log("storage cleared"); }catch(e){}
    }catch(e){
      log("error: " + (e && e.message ? e.message : e));
    }
    const hub = "/hub/?cb=" + Date.now();
    log("redirect -> " + hub);
    location.replace(hub);
  })();
  </script>
</body>
</html>