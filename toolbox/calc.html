<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Toolbox | 計算機</title>
  <meta name="description" content="よく使う計算をサクッと。お金/健康/生活/日付/旅/学業/副業の定番計算機。" />
  <link rel="stylesheet" href="./assets/style.css?v=6" />
</head>
<body>
  <div class="bg-orb o1"></div><div class="bg-orb o2"></div><div class="bg-orb o3"></div>
  <div class="wrap">
    <header class="top">
      <a class="brand" href="./index.html">
        <span class="logo"></span>
        <span class="mascot" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M6 12c0-4 2.7-7 6-7s6 3 6 7-2.7 7-6 7-6-3-6-7Z" fill="rgba(255,95,162,.35)"/>
            <path d="M8.8 12.3c0-.6.5-1.1 1.1-1.1s1.1.5 1.1 1.1-.5 1.1-1.1 1.1-1.1-.5-1.1-1.1Z" fill="rgba(20,22,28,.75)"/>
            <path d="M13 12.3c0-.6.5-1.1 1.1-1.1s1.1.5 1.1 1.1-.5 1.1-1.1 1.1-1.1-.5-1.1-1.1Z" fill="rgba(20,22,28,.75)"/>
            <path d="M9.6 15.3c1 .9 3.8.9 4.8 0" stroke="rgba(20,22,28,.65)" stroke-width="1.4" stroke-linecap="round"/>
            <path d="M5.2 8.2c.9-1.5 2.6-3 4.4-3.6" stroke="rgba(92,200,255,.75)" stroke-width="1.4" stroke-linecap="round"/>
            <path d="M18.8 8.2c-.9-1.5-2.6-3-4.4-3.6" stroke="rgba(123,108,255,.55)" stroke-width="1.4" stroke-linecap="round"/>
          </svg>
        </span>
        <strong>Toolbox</strong>
      </a>
      <nav class="nav">
        <a href="../sns-growth-rank/">SNS Growth Rank</a>
        <a href="../calculator/">旧Calculator</a>
        <a href="./disclosure.html">広告/PR</a>
      </nav>
    </header>

    <main>
      <section class="hero">
        <h1>計算機</h1>
        <p>よく使うやつ、まとめ。検索して即使う。</p>
      </section>

      <section class="card">
        <div class="row">
          <div class="field">
            <label>計算機</label>
            <select id="toolSelect"></select>
          </div>
          <div class="field">
            <label>検索</label>
            <input id="search" placeholder="例：ローン / BMI / % / 旅行 / 割引" />
          </div>
        </div>

        <div class="toolchips" id="catChips"></div>

        <div class="grid toolgrid" id="list"></div>
      </section>

      <section class="card" id="runner">
        <h2 id="toolTitle">計算</h2>
        <p id="toolDesc" class="muted">入力して結果を見る。</p>

        <div class="row" id="fields"></div>

        <div class="kpi">
          <div class="box">
            <small>結果</small>
            <strong id="resultMain">—</strong> <span id="resultUnit" class="muted"></span>
          </div>
          <div class="box">
            <small>メモ</small>
            <strong id="resultSub">—</strong>
          </div>
        </div>

        <div class="note" id="resultExtra" style="display:none"></div>

        <div class="adbox">
          <small>AdSense枠（必要ならここにコード）</small>
          <div class="muted">※コンテンツと区別して配置する。</div>
        </div>

        <div class="footer">
          <a href="./index.html">← ツール一覧へ</a>
        </div>
      </section>
    </main>
  </div>

  <script src="./assets/tools.js?v=6"></script>
  <script>
    const tools = (window.TOOLBOX_TOOLS||[]).slice();
    const byId = Object.fromEntries(tools.map(t=>[t.id,t]));
    const $ = (q)=>document.querySelector(q);

    const toolSelect = $("#toolSelect");
    const search = $("#search");
    const list = $("#list");
    const fields = $("#fields");
    const toolTitle = $("#toolTitle");
    const toolDesc = $("#toolDesc");
    const resultMain = $("#resultMain");
    const resultUnit = $("#resultUnit");
    const resultSub = $("#resultSub");
    const resultExtra = $("#resultExtra");
    const catChips = $("#catChips");

    const cats = Array.from(new Set(tools.map(t=>t.cat)));
    let activeCat = "すべて";

    function esc(s){ return String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])); }

    function renderCats(){
      const all = ["すべて", ...cats];
      catChips.innerHTML = all.map(c=>{
        const on = (c===activeCat) ? " chip on" : " chip";
        return `<button class="${on}" type="button" data-cat="${esc(c)}">${esc(c)}</button>`;
      }).join("");
      catChips.querySelectorAll("button").forEach(b=>{
        b.addEventListener("click", ()=>{
          activeCat = b.dataset.cat;
          renderList();
        });
      });
    }

    function renderList(){
      const q = (search.value||"").toLowerCase().trim();
      const filtered = tools.filter(t=>{
        const hit = (t.name+" "+t.desc+" "+t.cat+" "+(t.tags||[]).join(" ")).toLowerCase().includes(q);
        const catOk = (activeCat==="すべて") || (t.cat===activeCat);
        return hit && catOk;
      });
      list.innerHTML = filtered.map(t=>`
        <a class="toolcard" href="./calc.html#${esc(t.id)}">
          <div class="toolhead">
            <div class="toolic">${esc(t.icon||"🧩")}</div>
            <div>
              <div class="toolname">${esc(t.name)}</div>
              <div class="tooldesc">${esc(t.desc)}</div>
            </div>
          </div>
          <div class="toolmeta">${esc(t.cat)}</div>
        </a>
      `).join("");
      // also sync select
      toolSelect.innerHTML = filtered.map(t=>`<option value="${esc(t.id)}">${esc(t.icon||"")} ${esc(t.name)}（${esc(t.cat)}）</option>`).join("");
    }

    function fieldEl(f, val){
      const id = "f_"+f.k;
      const v = (val!==undefined && val!==null) ? val : (f.v ?? "");
      if(f.t==="select"){
        const opts = (f.options||[]).map(([k,l])=>{
          const sel = String(k)===String(v) ? "selected" : "";
          return `<option value="${esc(k)}" ${sel}>${esc(l)}</option>`;
        }).join("");
        return `
          <div class="field">
            <label for="${esc(id)}">${esc(f.l)}</label>
            <select id="${esc(id)}" data-k="${esc(f.k)}">${opts}</select>
          </div>`;
      }
      const step = f.step ?? "any";
      const type = f.t || "number";
      return `
        <div class="field">
          <label for="${esc(id)}">${esc(f.l)}</label>
          <input id="${esc(id)}" data-k="${esc(f.k)}" type="${esc(type)}" step="${esc(step)}" value="${esc(v)}" />
        </div>`;
    }

    function readValues(tool){
      const v = {};
      tool.fields.forEach(f=>{
        const el = document.querySelector('[data-k="'+f.k+'"]');
        if(!el) return;
        if(f.t==="number") v[f.k] = (el.value==="") ? 0 : Number(el.value);
        else v[f.k] = el.value;
      });
      return v;
    }

    function run(tool){
      const v = readValues(tool);
      const out = tool.compute(v) || {};
      const main = out.main;
      const unit = out.unit || "";
      resultUnit.textContent = unit ? (" "+unit) : "";
      if(typeof main==="number"){
        resultMain.textContent = (unit==="%" ? main.toFixed(2) : Math.round(main).toLocaleString("ja-JP"));
      }else{
        resultMain.textContent = String(main ?? "—");
      }
      resultSub.textContent = String(out.sub ?? "—");

      const extra = out.extra || [];
      if(extra.length){
        resultExtra.style.display = "";
        resultExtra.innerHTML = extra.map(x=>`• ${esc(x)}`).join("<br>");
      }else{
        resultExtra.style.display = "none";
        resultExtra.textContent = "";
      }
    }

    function mount(toolId){
      const tool = byId[toolId] || tools[0];
      if(!tool) return;

      toolTitle.textContent = (tool.icon?tool.icon+" ":"") + tool.name;
      toolDesc.textContent = tool.desc || "";

      fields.innerHTML = tool.fields.map(f=>fieldEl(f)).join("");
      fields.querySelectorAll("input,select").forEach(el=>{
        el.addEventListener("input", ()=>run(tool));
        el.addEventListener("change", ()=>run(tool));
      });

      toolSelect.value = tool.id;
      toolSelect.onchange = ()=>{ location.hash = toolSelect.value; };

      run(tool);
      document.getElementById("runner").scrollIntoView({behavior:"smooth", block:"start"});
    }

    function hashTool(){
      const h = (location.hash||"").replace("#","").trim();
      return h;
    }

    renderCats();
    renderList();

    search.addEventListener("input", renderList);

    window.addEventListener("hashchange", ()=>mount(hashTool()));
    const initial = hashTool() || tools[0]?.id;
    if(initial) mount(initial);
  </script>
<script>
/*__TOOLBOX_TOOLMODE__*/
(function(){
  const params = new URLSearchParams(location.search);
  const tool = params.get('tool');
  if(!tool) return;

  const META = {};

  document.body.classList.add('tool-only');

  // 1) 一覧エリアっぽいものをなるべく消す（select/検索/タブ/カード）
  try{
    const kill = [];
    document.querySelectorAll('select, input, button').forEach(el=>{
      const p = el.closest('section,div,header,main');
      if(p) kill.push(p);
    });
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      const p = a.closest('section,div,nav,header,main');
      if(p) kill.push(p);
    });
    // 上位の重複を減らして、上から順に隠す（過剰に消しすぎないように main/section/div だけ）
    const uniq = Array.from(new Set(kill)).filter(x=>x && x.tagName && x.tagName.match(/^(MAIN|SECTION|DIV|NAV)$/));
    uniq.forEach(x=>{
      // ターゲットを含むものは残す
      const t = document.getElementById(tool);
      if(t && x.contains(t)) return;
      // ただしヘッダーっぽいのは残す（サイト名があるやつ）
      const txt = (x.innerText||'').slice(0,80);
      if(txt.match(/Toolbox/i)) return;
      x.style.display = 'none';
    });
  }catch(e){}

  // 2) ターゲット以外のツールセクションを隠す（idがあれば）
  try{
    const t = document.getElementById(tool);
    if(t){
      // 同階層に並んでる“ツールっぽいid要素”は全部消して、targetだけ表示
      const ids = Object.keys(META||{});
      ids.forEach(id=>{
        if(id===tool) return;
        const el = document.getElementById(id);
        if(el) el.style.display='none';
      });

      // 解説ボックスを差し込み
      const info = (META && META[tool]) ? META[tool] : {title:tool, desc:'数値を入れて即計算。'};
      const box = document.createElement('div');
      box.className = 'tool-note';
      box.innerHTML =
        '<div class="tool-note-inner">'+
          '<div class="tool-note-title">'+info.title+'</div>'+
          '<div class="tool-note-desc">'+info.desc+'</div>'+
          '<div class="tool-note-links">'+
            '<a href="./calc.html" class="tool-note-back">← ツール一覧へ</a>'+
          '</div>'+
        '</div>';
      t.parentElement.insertBefore(box, t);

      // ちょい上にスクロール
      t.scrollIntoView({behavior:'instant', block:'start'});
      window.scrollBy(0, -10);
    }
  }catch(e){}

})();
</script>
<style>
  /* tool-only mode の見た目 */
  .tool-note{margin:12px auto; max-width:1100px; padding:0 14px;}
  .tool-note-inner{
    border:1px solid rgba(0,0,0,.10);
    border-radius:18px;
    background:rgba(255,255,255,.70);
    padding:12px 12px;
    box-shadow:0 10px 22px rgba(18,22,40,.08);
  }
  .tool-note-title{font-weight:800; font-size:16px; margin:0 0 6px;}
  .tool-note-desc{color:rgba(0,0,0,.60); line-height:1.7; margin:0 0 8px;}
  .tool-note-back{display:inline-block; text-decoration:none; font-weight:700;}
</style>
</body>
</html>

